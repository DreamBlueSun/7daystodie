<Marisa>

    <!-- 虹彩技能分类 -->
    <insertAfter xpath="/progression/skills/skill[@name='skillIridescentItem']">

        <!-- 虹彩：附魔类技能 -->
        <skill name="skillIridescentEnhanced" parent="attIridescent" name_key="skillIridescentEnhancedName" desc_key="skillIridescentEnhancedDesc" icon="ui_game_symbol_forge"><effect_group/></skill>
        <!-- 虹彩：套装类技能 -->
        <skill name="skillIridescentSuit" parent="attIridescent" name_key="skillIridescentSuitName" desc_key="skillIridescentSuitDesc" icon="ui_game_symbol_light_armor"><effect_group/></skill>

    </insertAfter>



    <!-- 虹彩技能 -->
    <append xpath="/progression/perks">

        <!-- *** 防御类技能 -->
        <!-- ** 转祸为福 -->
        <perk name="perkMarisaTurnBadLuckIntoABlessing" parent="skillIridescentDefend" name_key="perkMarisaTurnBadLuckIntoABlessingName" desc_key="perkMarisaTurnBadLuckIntoABlessingDesc" icon="ui_game_symbol_diamond" max_level="3" base_skill_point_cost="0">
            <level_requirements level="1"><requirement name="ProgressionLevel" progression_name="attIridescent" operation="GTE" value="1" desc_key="reqIridescentLevel01"/></level_requirements>
            <level_requirements level="2"><requirement name="ProgressionLevel" progression_name="attIridescent" operation="GTE" value="1" desc_key="reqIridescentLevel01"/></level_requirements>
            <level_requirements level="3"><requirement name="ProgressionLevel" progression_name="attIridescent" operation="GTE" value="1" desc_key="reqIridescentLevel01"/></level_requirements>

            <effect_group>
                <effect_description level="1" desc_key="perkMarisaTurnBadLuckIntoABlessingRank1Desc" long_desc_key="perkMarisaTurnBadLuckIntoABlessingRank1LongDesc"/>
                <effect_description level="2" desc_key="perkMarisaTurnBadLuckIntoABlessingRank2Desc" long_desc_key="perkMarisaTurnBadLuckIntoABlessingRank2LongDesc"/>
                <effect_description level="3" desc_key="perkMarisaTurnBadLuckIntoABlessingRank3Desc" long_desc_key="perkMarisaTurnBadLuckIntoABlessingRank3LongDesc"/>
            </effect_group>
        </perk>

    </append>



    <!-- 丧尸掉落 -->
    <insertAfter xpath="/progression/perks/perk[@name='perkMarisaTrack']/effect_group/requirement[@tags='crystallization']">
        <requirement name="!EntityTagCompare" target="other" tags="berserk"/>
    </insertAfter>
    <append xpath="/progression/perks/perk[@name='perkMarisaTrack']">

        <!-- 狂化丧尸 通用 T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombie"/>
            <requirement name="!EntityTagCompare" target="other" tags="animal"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="80"/>
                <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieT3" allow_client_call="true"/>
        </effect_group>

        <!-- 提取素 狂化 Arlene T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieArleneExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieArleneExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Marlene T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieMarleneExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieMarleneExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 PartyGirl T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombiePartyGirlExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombiePartyGirlExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Nurse T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieNurseExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieNurseExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Joe T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieJoeExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieJoeExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Steve T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieSteveExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieSteveExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 TomClark T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieTomClarkExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieTomClarkExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 BusinessMan T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieBusinessManExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieBusinessManExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Burnt T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieBurntExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieBurntExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Spider T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieSpiderExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieSpiderExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Boe T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieBoeExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieBoeExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 MaleHazmat T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieMaleHazmatExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieMaleHazmatExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Janitor T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieJanitorExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieJanitorExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Inmate T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieInmateExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieInmateExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Moe T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieMoeExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieMoeExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Lab T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieLabExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieLabExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Darlene T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieDarleneExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieDarleneExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Yo T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieYoExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieYoExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 UtilityWorker T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieUtilityWorkerExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieUtilityWorkerExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Biker T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieBikerExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieBikerExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Lumberjack T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieLumberjackExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieLumberjackExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 FemaleFat T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieFemaleFatExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieFemaleFatExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 FatHawaiian T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieFatHawaiianExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieFatHawaiianExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Bowler T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieBowlerExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieBowlerExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 FatCop T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieFatCopExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieFatCopExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Skateboarder T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieSkateboarderExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieSkateboarderExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Soldier T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieSoldierExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieSoldierExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Wight T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieWightExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieWightExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Screamer T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieScreamerExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieScreamerExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Mutated T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieMutatedExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieMutatedExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 Demolition T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieDemolitionExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieDemolitionExtractT3" allow_client_call="true"/>
        </effect_group>
        <!-- 提取素 狂化 SteveCrawler T3 -->
        <effect_group>
            <requirement name="EntityTagCompare" target="other" tags="zombieSteveCrawlerExtract"/>
            <requirement name="EntityTagCompare" target="other" tags="berserk"/>
            <requirement name="RandomRoll" seed_type="Random" min_max="0,100" operation="LTE" value="2"/>
            <triggered_effect trigger="onSelfKilledOther" action="CallGameEvent" event="EventDropIridescentResourceZombieSteveCrawlerExtractT3" allow_client_call="true"/>
        </effect_group>


    </append>

</Marisa>